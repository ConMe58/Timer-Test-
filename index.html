<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>ME Timer</title>

  <style>
    /* ---------- Farb-Setup: Auto Dark / Light ---------- */

    :root {
      --bg: #ffffff;
      --fg: #000000;
      --muted: #6b7280;
      --accent: #22c55e;
      --overlay: rgba(0, 0, 0, 0.4);
      --panel-bg: rgba(255, 255, 255, 0.97);
      --shadow: 0 18px 45px rgba(15, 23, 42, 0.35);
      --border-subtle: rgba(15, 23, 42, 0.1);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #000000;
        --fg: #ffffff;
        --muted: #9ca3af;
        --accent: #22c55e;
        --overlay: rgba(0, 0, 0, 0.65);
        --panel-bg: rgba(15, 23, 42, 0.98);
        --shadow: 0 18px 50px rgba(0, 0, 0, 0.8);
        --border-subtle: rgba(148, 163, 184, 0.16);
      }
    }

    /* ---------- Basislayout ---------- */

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", Inter, system-ui, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
    }

    .page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6vh 20px 7vh;
    }

    main {
      width: 100%;
      max-width: 640px;
    }

    /* ---------- Menü-Button ---------- */

    .menu-toggle {
      position: fixed;
      top: 14px;
      left: 16px;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.08);
      backdrop-filter: blur(10px);
      z-index: 40;
      transition: 0.15s ease;
    }

    .menu-toggle span,
    .menu-toggle span::before,
    .menu-toggle span::after {
      display: block;
      width: 16px;
      height: 2px;
      border-radius: 999px;
      background: var(--fg);
      content: "";
    }

    .menu-toggle span { position: relative; }
    .menu-toggle span::before { position: absolute; top: -5px; left: 0; }
    .menu-toggle span::after  { position: absolute; top:  5px; left: 0; }

    .menu-toggle:active { transform: scale(0.94); }

    /* ---------- Timer ---------- */

    .timer { margin-bottom: 52px; }
    .timer:last-child { margin-bottom: 0; }

    .timer-title {
      margin: 0 0 10px;
      text-align: center;
      font-weight: 700;
      letter-spacing: 0.02em;
      font-size: clamp(1.45rem, 2.8vw, 1.9rem);
    }

    .timer-row {
      display: flex;
      justify-content: center;
      gap: clamp(16px, 4vw, 28px);
      flex-wrap: nowrap;
    }

    .timer-unit { text-align: center; }

    .timer-value {
      font-weight: 800;
      font-variant-numeric: tabular-nums;
      letter-spacing: 0.06em;
      font-size: clamp(2.7rem, 8vw, 3.8rem);
      line-height: 1.1;
    }

    .timer-label {
      margin-top: 4px;
      font-size: 0.74rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      font-weight: 600;
      color: var(--muted);
      opacity: 0.92;
      text-align: center;
    }

    /* ---------- Seitenleiste ---------- */

    .backdrop {
      position: fixed;
      inset: 0;
      background: var(--overlay);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.18s ease;
      z-index: 45;
    }

    body.sidebar-open .backdrop {
      opacity: 1;
      pointer-events: auto;
    }

    .sidebar {
      position: fixed;
      inset: 0 auto 0 0;
      width: min(320px, 82vw);
      transform: translateX(-100%);
      transition: 0.22s ease-out;
      z-index: 50;
      display: flex;
    }

    body.sidebar-open .sidebar { transform: translateX(0); }

    .sidebar-inner {
      background: var(--panel-bg);
      color: var(--fg);
      box-shadow: var(--shadow);
      padding: 18px 18px 20px;
      border-right: 1px solid var(--border-subtle);
      overflow-y: auto;
      width: 100%;
    }

    .sidebar-inner h2 {
      margin: 4px 0 4px;
      font-size: 1.05rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .sidebar-hint {
      margin: 0 0 10px;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .timer-item {
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      padding: 10px 10px 12px;
      margin-top: 10px;
    }

    .timer-item label {
      display: block;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .timer-item input[type="text"] {
      width: 100%;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      padding: 6px 7px;
      font-size: 0.86rem;
      background: rgba(15, 23, 42, 0.04);
      color: var(--fg);
      outline: none;
    }

    .timer-item input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.4);
      background: rgba(15, 23, 42, 0.07);
    }

    .timer-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .btn {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.06);
      color: var(--fg);
      font-size: 0.8rem;
      padding: 6px 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: 0.12s ease;
    }

    .btn-primary {
      border-color: rgba(34, 197, 94, 0.85);
      background: rgba(34, 197, 94, 0.13);
    }

    .btn-danger {
      border-color: rgba(248, 113, 113, 0.85);
      background: rgba(248, 113, 113, 0.13);
    }

    .btn:active { transform: scale(0.96); }

    #addTimerBtn { width: 100%; margin-top: 16px; }
  </style>
</head>
<body>

  <!-- Menü-Button -->
  <div class="menu-toggle" id="menuToggle">
    <span></span>
  </div>

  <!-- Inhalt -->
  <div class="page">
    <main id="timers"></main>
  </div>

  <!-- Sidebar -->
  <div class="backdrop" id="backdrop"></div>
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-inner">
      <h2>Timer verwalten</h2>
      <p class="sidebar-hint">Format: <strong>TT.MM.JJJJ HH:MM</strong></p>
      <div id="timerList"></div>
      <button class="btn btn-primary" id="addTimerBtn">+ Timer hinzufügen</button>
    </div>
  </aside>

  <script>
    const STORAGE_KEY = "meTimersV1";

    let timers = [];

    function loadTimers() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) {
        timers = [];
        saveTimers();
      } else {
        timers = JSON.parse(raw);
      }
    }

    function saveTimers() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(timers));
    }

    function pad(n) { return String(n).padStart(2, "0"); }

    function parseDateString(str) {
      const m = str.match(/^(\d{1,2})\.(\d{1,2})\.(\d{4})\s+(\d{1,2}):(\d{2})$/);
      if (!m) return null;
      const d = new Date(+m[3], m[2] - 1, +m[1], +m[4], +m[5]);
      return isNaN(d) ? null : d;
    }

    function formatInputDate(iso) {
      const d = new Date(iso);
      return `${pad(d.getDate())}.${pad(d.getMonth()+1)}.${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    const timersContainer = document.getElementById("timers");

    function renderTimers() {
      timersContainer.innerHTML = "";

      timers.forEach((t, index) => {
        const section = document.createElement("section");
        section.className = "timer";

        const title = document.createElement("h2");
        title.className = "timer-title";
        title.textContent = t.label || "Timer";
        section.appendChild(title);

        const row = document.createElement("div");
        row.className = "timer-row";

        ["days", "hours", "minutes", "seconds"].forEach(unit => {
          const unitDiv = document.createElement("div");
          unitDiv.className = "timer-unit";

          const value = document.createElement("div");
          value.className = "timer-value";
          value.dataset.index = index;
          value.dataset.unit = unit;
          value.textContent = "00";

          const label = document.createElement("div");
          label.className = "timer-label";
          label.dataset.index = index;
          label.dataset.unit = unit;

          unitDiv.appendChild(value);
          unitDiv.appendChild(label);
          row.appendChild(unitDiv);
        });

        section.appendChild(row);
        timersContainer.appendChild(section);
      });
    }

    const singular = {
      days: "Tag",
      hours: "Stunde",
      minutes: "Minute",
      seconds: "Sekunde"
    };

    const plural = {
      days: "Tage",
      hours: "Stunden",
      minutes: "Minuten",
      seconds: "Sekunden"
    };

    function updateTimers() {
      const now = new Date();

      timers.forEach((t, index) => {
        const start = new Date(t.startISO);
        let sec = Math.floor((now - start) / 1000);
        if (sec < 0) sec = 0;

        const days = Math.floor(sec / 86400); sec %= 86400;
        const hours = Math.floor(sec / 3600); sec %= 3600;
        const minutes = Math.floor(sec / 60);
        const seconds = sec % 60;

        const values = { days, hours, minutes, seconds };

        for (const unit of ["days","hours","minutes","seconds"]) {
          const v = values[unit];

          const el = document.querySelector(`.timer-value[data-index="${index}"][data-unit="${unit}"]`);
          if (el) el.textContent = unit === "days" ? String(v) : pad(v);

          const label = document.querySelector(`.timer-label[data-index="${index}"][data-unit="${unit}"]`);
          if (label) {
            const text = (v === 1 ? singular[unit] : plural[unit]).toUpperCase();
            label.textContent = text;
          }
        }
      });
    }

    /* ---------- Sidebar ---------- */

    const timerList = document.getElementById("timerList");
    const addTimerBtn = document.getElementById("addTimerBtn");

    function renderSidebar() {
      timerList.innerHTML = "";

      timers.forEach((t, index) => {
        const item = document.createElement("div");
        item.className = "timer-item";

        const l1 = document.createElement("label");
        l1.textContent = "Titel";
        const inp1 = document.createElement("input");
        inp1.type = "text";
        inp1.value = t.label;
        inp1.onchange = () => {
          timers[index].label = inp1.value || "Timer";
          saveTimers();
          renderTimers();
        };

        const l2 = document.createElement("label");
        l2.textContent = "Startzeit";

        const inp2 = document.createElement("input");
        inp2.type = "text";
        inp2.value = formatInputDate(t.startISO);
        inp2.onchange = () => {
          const d = parseDateString(inp2.value);
          if (!d) return alert("Format: TT.MM.JJJJ HH:MM");
          t.startISO = d.toISOString();
          saveTimers();
          renderTimers();
        };

        const actions = document.createElement("div");
        actions.className = "timer-actions";

        const nowBtn = document.createElement("button");
        nowBtn.className = "btn";
        nowBtn.textContent = "Start = jetzt";
        nowBtn.onclick = () => {
          const d = new Date();
          t.startISO = d.toISOString();
          inp2.value = formatInputDate(t.startISO);
          saveTimers();
          renderTimers();
        };

        const delBtn = document.createElement("button");
        delBtn.className = "btn btn-danger";
        delBtn.textContent = "Löschen";
        delBtn.onclick = () => {
          if (confirm("Timer löschen?")) {
            timers.splice(index, 1);
            saveTimers();
            renderTimers();
            renderSidebar();
          }
        };

        actions.appendChild(nowBtn);
        actions.appendChild(delBtn);

        item.appendChild(l1);
        item.appendChild(inp1);
        item.appendChild(l2);
        item.appendChild(inp2);
        item.appendChild(actions);

        timerList.appendChild(item);
      });
    }

    /* ---------- Sidebar Toggle ---------- */

    const menuToggle = document.getElementById("menuToggle");
    const backdrop = document.getElementById("backdrop");
    const sidebar = document.getElementById("sidebar");

    menuToggle.onclick = () => { document.body.classList.toggle("sidebar-open"); };
    backdrop.onclick = () => { document.body.classList.remove("sidebar-open"); };

    /* ---------- Init ---------- */

    loadTimers();
    renderTimers();
    renderSidebar();
    updateTimers();
    setInterval(updateTimers, 1000);
  </script>

</body>
</html>
