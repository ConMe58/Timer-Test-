<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ME Timer</title>

<meta name="color-scheme" content="light dark" />
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" />
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000000" />

<style>
  :root {
    --bg: #ffffff;
    --fg: #000000;
    --muted: rgba(0,0,0,0.7);
  }
  @media (prefers-color-scheme: dark) {
    :root { --bg:#000; --fg:#fff; --muted:rgba(255,255,255,0.7); }
  }

  html, body {
    margin:0; height:100%;
    background:var(--bg); color:var(--fg);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    display:flex; flex-direction:column; align-items:center;
    padding:30px 10px; gap:40px;
  }

  h1 { font-size:clamp(22px,5vw,32px); margin:0; }

  .timerBlock {
    border:1px solid var(--muted);
    border-radius:12px; padding:16px 20px;
    display:flex; flex-direction:column; align-items:center;
    gap:16px; max-width:90%;
  }

  .title { font-weight:700; font-size:clamp(18px,4vw,26px); text-align:center; }

  .timer {
    display:grid;
    grid-template-columns:auto auto auto auto;
    gap:14px; justify-content:center;
  }
  .col { display:flex; flex-direction:column; align-items:center; }
  .num { font-size:clamp(24px,10vw,64px); font-weight:800; }
  .label { font-size:clamp(10px,3vw,16px); color:var(--muted); }

  button {
    background:none; border:1px solid var(--muted);
    border-radius:6px; color:var(--fg);
    padding:6px 12px; font-size:14px; cursor:pointer;
  }
  button:hover { opacity:0.8; }

  .controls {
    display:flex; flex-wrap:wrap; justify-content:center; gap:10px;
  }
</style>
</head>
<body>
<h1>ME Timer</h1>
<div id="container"></div>

<div class="controls">
  <button onclick="addTimer()">Ôºã Neuer Timer</button>
  <button onclick="resetAll()">üóëÔ∏è Alle l√∂schen</button>
</div>

<script>
let timers = JSON.parse(localStorage.getItem("meTimers") || "[]");

const container = document.getElementById("container");
const pad = n => String(n).padStart(2,"0");

function drawTimer(now, start, el) {
  const diff = Math.floor((now - new Date(start).getTime()) / 1000);
  const d = Math.floor(diff / 86400);
  const h = Math.floor((diff % 86400) / 3600);
  const m = Math.floor((diff % 3600) / 60);
  const s = diff % 60;
  el.querySelector(".d").textContent = d;
  el.querySelector(".h").textContent = pad(h);
  el.querySelector(".m").textContent = pad(m);
  el.querySelector(".s").textContent = pad(s);
}

function renderTimers() {
  container.innerHTML = "";
  timers.forEach((t, i) => {
    const block = document.createElement("div");
    block.className = "timerBlock";
    block.innerHTML = `
      <div contenteditable="true" class="title" oninput="editTitle(${i}, this.textContent)">${t.title}</div>
      <div class="timer">
        <div class="col"><div class="num d">0</div><div class="label">TAGE</div></div>
        <div class="col"><div class="num h">00</div><div class="label">STD</div></div>
        <div class="col"><div class="num m">00</div><div class="label">MIN</div></div>
        <div class="col"><div class="num s">00</div><div class="label">SEK</div></div>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
        <input type="datetime-local" value="${t.start}" onchange="editDate(${i}, this.value)" />
        <button onclick="deleteTimer(${i})">L√∂schen</button>
      </div>
    `;
    container.appendChild(block);
  });
}

function updateTimers() {
  const now = Date.now();
  document.querySelectorAll(".timerBlock").forEach((b, i)=>{
    if (timers[i]) drawTimer(now, timers[i].start, b);
  });
}

function addTimer() {
  const title = prompt("Titel des neuen Timers:");
  if (!title) return;
  const date = prompt("Startdatum (YYYY-MM-DDTHH:MM, z.B. 2022-12-10T12:00):");
  if (!date) return;
  timers.push({title, start: date});
  saveTimers();
  renderTimers();
}

function editTitle(i, txt) {
  timers[i].title = txt.trim();
  saveTimers();
}

function editDate(i, val) {
  timers[i].start = val;
  saveTimers();
}

function deleteTimer(i) {
  if (confirm("Timer wirklich l√∂schen?")) {
    timers.splice(i,1);
    saveTimers();
    renderTimers();
  }
}

function resetAll() {
  if (confirm("Wirklich ALLE Timer l√∂schen?")) {
    timers = [];
    saveTimers();
    renderTimers();
  }
}

function saveTimers() {
  localStorage.setItem("meTimers", JSON.stringify(timers));
}

renderTimers();
updateTimers();
setInterval(updateTimers, 1000);
</script>
</body>
</html>
